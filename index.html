<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Python best 30</title>

        <!-- codemirror -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/mode/python/python.min.js"></script>

        <!-- pyscript -->
        <link
            rel="stylesheet"
            href="https://pyscript.net/latest/pyscript.css"
        />
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
        <!--
        <py-config type="json">
        {
            "packages": ["numpy", "matplotlib"]
        }
        </py-config>
        -->
        
        <!-- custom js, css -->
        <script src="./src/js/editor.js" defer=""></script>
        <script src="./src/js/parser.js" defer=""></script>
    </head>

    <body>
        <a href="codeexec.html">실행해보기</a>
        <div class="description"></div>
        <form>
            <div class="state-area">
                <div class="editor">
                    <textarea id="codeeditor"></textarea>
                </div>
            </div>
        </form>
        <label for="testcase1">testcase1</label>
        <input id="testcase1"/>
        <label for="testcase1">testcase2</label>
        <input id="testcase2"/>
        <label for="testcase1">testcase3</label>
        <input id="testcase3"/>
        <div class="btn-contain">
            <button id="btn-run" type="submit">Run Python</button>
        </div>
        <div id="result">result</div>
        <div id="error">애러명</div>
        <py-script>
        import ast

        answer = ['30', '70', '110']

        def result(*ags, **kws):
            code = Element("codeeditor").element.innerText
            testCase1 = Element("testcase1").element.value
            testCase2 = Element("testcase2").element.value
            testCase3 = Element("testcase3").element.value
            # js.console.log('-------')
            # js.console.log(testCase)
            # js.console.log('-------')
            testCase = f'[{testCase1}, {testCase2}, {testCase3}]'
            code += f'\n[solution(a, b) for a, b in {testCase}]'
            try:
                result = multiline_eval(code)
                result = result.replace('[', '').replace(']', '').strip().split(',')
                result1 = result[0].strip()
                result2 = result[1].strip()
                result3 = result[2].strip()
                pyscript.write('result', f"테스트케이스번호 : 통과여부(실행값==정답값) ----> test1 : {'통과' if result1 == answer[0] else '실패'}({result1}=={answer[0]}), test2 : {'통과' if result2 == answer[1] else '실패'}({result2}=={answer[1]}), test3 : {'통과' if result3 == answer[2] else '실패'}({result3}=={answer[2]})")
                pyscript.write('error', f'')
            except Exception as e:
                # 이슈1 : \n 개행이 write안에서 먹지 않습니다
                # 이슈2 : <br> 개행이 write안에서 먹지 않습니다
                # 이슈3 : 이에대한 공식 API 문서가 없습니다. 소스코드를 보고 이해해야 합니다.
                #elementh1 = js.document.createElement('h1')
                #elementh1.innerText = "Hello"
                result = f'애러입니다. 문제를 다시 풀어주세요.'
                #result = js.document.querySelector('#result')
                #result.innerText = elementh1
                pyscript.write('result', result)
                pyscript.write('error', f'애러명 : {e}')


        def multiline_eval(expr, ctx={}):
            results = []
            for node in ast.parse(expr).body:
                if isinstance(node, ast.Expr):
                    result = eval(compile(ast.Expression(node.value), 'string', 'eval'), ctx)
                    results.append(result)            
                else:
                    module = ast.Module([node], type_ignores=[])
                    results.append(exec(compile(module, 'string', 'exec'), ctx))
            return '\n'.join(map(str, results))[5:]

        button_run = Element("btn-run")
        button_run.element.onclick = result
        </py-script>
    </body>
</html>
